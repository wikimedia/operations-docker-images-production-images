FROM docker-registry.wikimedia.org/golang1.15 as build

{% set repo_base = '/go/github.com/kserve' %}

USER nobody
RUN mkdir -p {{ repo_base }} \
  && cd {{ repo_base }} \
  && git clone https://github.com/kserve/kserve.git kserve \
  && cd kserve \
  && git checkout tags/v0.7.0

WORKDIR {{ repo_base }}/kserve/cmd
RUN cd manager && go build && cd ../agent && go build